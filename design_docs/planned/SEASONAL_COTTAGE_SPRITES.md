# Seasonal Cottage Sprites

## Summary

Add seasonal sprite variations for the cottage (COTTAGE tile type) to display different appearances in summer and autumn seasons. Currently, the cottage only has spring and winter variants. This enhancement will provide visual variety and seasonal atmosphere to the game world.

## Problem Statement

- The COTTAGE tile type (TileType.COTTAGE) currently uses only two sprites:
  - Spring/Summer/Autumn: `cottage_small_spring.png`
  - Winter: `cottage_small_winter.png`
- All warm seasons show the same spring sprite, reducing visual variety
- The game has full seasonal system support but underutilizes it for the cottage

## Design

### Data Structures

**Assets Configuration** (`assets.ts`):
```typescript
export const tileAssets = {
  // ... existing assets ...
  cottage_wooden: '/TwilightGame/assets-optimized/tiles/cottage_small_spring.png',
  cottage_small_summer: '/TwilightGame/assets-optimized/tiles/cottage_small_summer.png',
  cottage_small_autumn: '/TwilightGame/assets-optimized/tiles/cottage_small_autumn.png',
  cottage_small_winter: '/TwilightGame/assets-optimized/tiles/cottage_small_winter.png',
};
```

**Tile Legend** (`data/tiles.ts`):
```typescript
[TileType.COTTAGE]: {
  name: 'Cottage',
  color: 'bg-palette-sage',
  collisionType: CollisionType.SOLID,
  image: [],
  seasonalImages: {
    spring: [tileAssets.cottage_wooden],           // Spring version
    summer: [tileAssets.cottage_small_summer],     // New summer variant
    autumn: [tileAssets.cottage_small_autumn],     // New autumn variant
    winter: [tileAssets.cottage_small_winter],     // Winter version (unchanged)
    default: [tileAssets.cottage_wooden],
  },
},
```

**Sprite Metadata** (`data/spriteMetadata.ts`):
- No changes required - uses `tileAssets.cottage_wooden` as default image
- Seasonal rendering is handled by existing game engine at render time
- The sprite metadata provides fallback/default image only

### Rendering Pipeline

The seasonal sprite rendering follows this flow:

1. **Game State** tracks current season (Spring, Summer, Autumn, Winter)
2. **TileRenderer** (PixiJS layer) checks `seasonalImages` in TILE_LEGEND
3. **Sprite Selection**:
   - If current season exists in `seasonalImages`: use that sprite
   - Otherwise: use `default` from `seasonalImages`
   - Fallback: use `image` array from tile definition
4. **TextureManager** caches and loads selected sprite
5. **SpriteLayer** renders the selected seasonal texture

### File Structure

```
public/assets/tiles/
├── cottage_small_spring.png      (existing - spring/summer/autumn)
├── cottage_small_summer.png      (NEW - summer variant)
├── cottage_small_autumn.png      (NEW - autumn variant)
└── cottage_small_winter.png      (existing - winter)

public/assets-optimized/tiles/    (automatically generated by optimize-assets script)
├── cottage_small_spring.png
├── cottage_small_summer.png
├── cottage_small_autumn.png
└── cottage_small_winter.png
```

## Implementation Steps

### Step 1: Place Asset Files
- Add `cottage_small_summer.png` to `/public/assets/tiles/`
- Add `cottage_small_autumn.png` to `/public/assets/tiles/`
- These are high-quality source files (will be optimized automatically)

### Step 2: Update assets.ts
- Add `cottage_small_summer` asset reference
- Add `cottage_small_autumn` asset reference
- Follow naming convention: `cottage_small_[season].png`

**File**: `assets.ts` (lines 33-34)
- Insert new asset definitions after existing cottage assets
- Use optimized asset paths: `/TwilightGame/assets-optimized/tiles/cottage_small_*.png`

### Step 3: Update Tile Legend
- Modify `TileType.COTTAGE` in `data/tiles.ts` (lines 772-776)
- Change `seasonalImages` to use individual assets per season:
  - `spring`: `cottage_wooden` (current behavior)
  - `summer`: `cottage_small_summer` (NEW)
  - `autumn`: `cottage_small_autumn` (NEW)
  - `winter`: `cottage_small_winter` (current behavior)

### Step 4: Optimize Assets
- Run `npm run optimize-assets` to generate optimized versions
- Creates optimized PNG files in `/public/assets-optimized/tiles/`
- Automatically detects "cottage" keyword and applies 1024px size, 97% quality

### Step 5: Verify Game Engine
- No changes needed to sprite metadata (uses default image fallback)
- Rendering engine automatically uses seasonal images when present
- Existing tests and validation will pass without modification

### Step 6: Testing
- Start dev server: `npm run dev`
- Visit game at `http://localhost:4000/TwilightGame/`
- Change seasons through TimeManager or debug tools
- Verify cottage sprite changes match each season:
  - Spring: `cottage_small_spring.png`
  - Summer: `cottage_small_summer.png`
  - Autumn: `cottage_small_autumn.png`
  - Winter: `cottage_small_winter.png`

## Testing

### Manual Testing Steps

1. **Start Development Server**
   ```bash
   npm run dev
   ```

2. **Launch Game**
   - Open `http://localhost:4000/TwilightGame/` in browser
   - Wait for game to fully load

3. **Navigate to Cottage**
   - Move to any map location with a COTTAGE tile (e.g., village map)
   - Observe current cottage appearance

4. **Test Season Progression**
   - Use debug tools or natural time progression to cycle through seasons
   - For each season, verify:
     - Correct sprite is displayed
     - Sprite loads without errors (check console)
     - Sprite is properly scaled and positioned
     - No visual glitches or alignment issues

5. **Console Validation**
   - Open Chrome DevTools (F12)
   - Check for any texture loading errors
   - Verify no 404s for missing asset files
   - Confirm seasonal images are cached by TextureManager

6. **Visual Inspection**
   - Spring: Cottage with green ivy/plants (existing sprite)
   - Summer: Cottage with full lush vegetation (new sprite)
   - Autumn: Cottage with autumn colors/foliage (new sprite)
   - Winter: Cottage with snow/seasonal changes (existing sprite)

### Automated Checks

- TypeScript compilation: `npx tsc --noEmit` (should pass with zero errors)
- No new test framework required (seasonal rendering is existing feature)
- Sanity checks in `testUtils.ts` automatically validate tile configurations

### Regression Testing

Verify no existing functionality is broken:
- [ ] Other seasonal tiles still change (trees, bushes, etc.)
- [ ] Cottage collision/pathfinding still works
- [ ] Cottage sprite metadata still renders correctly
- [ ] Game performance unchanged (same number of sprites)

## Breaking Changes

None - this is purely additive:
- Existing seasonal image rendering pipeline unchanged
- Sprite metadata remains backward compatible
- Default fallback behavior preserved

## File Changes Summary

| File | Changes | Lines |
|------|---------|-------|
| `assets.ts` | Add 2 new asset definitions | +2 |
| `data/tiles.ts` | Update COTTAGE seasonalImages | 3 (modify) |
| `public/assets/tiles/` | Add 2 new PNG files | +2 files |
| `public/assets-optimized/tiles/` | Auto-generated by script | +2 files |

## Verification Checklist

After implementation:

- [ ] Both new PNG files exist in `/public/assets/tiles/`
- [ ] `assets.ts` has new asset definitions
- [ ] `data/tiles.ts` COTTAGE definition uses all 4 seasonal images
- [ ] `npm run optimize-assets` runs successfully
- [ ] Optimized files generated in `/public/assets-optimized/tiles/`
- [ ] Game loads without console errors
- [ ] Cottage sprite changes with seasons
- [ ] TypeScript compiles with zero errors: `npx tsc --noEmit`
- [ ] All existing functionality still works

## Notes

- Asset optimization is automatic via `npm run optimize-assets` script
- Cottage keyword triggers 1024px size (high-quality showcase tier)
- Seasonal sprite selection happens at render time (no storage overhead)
- Follows existing pattern used by: Shop, Garden Shed, Trees, etc.
- Linear (smooth) scaling is already configured in TextureManager

## Related Documentation

- `ASSETS.md` - Asset management and guidelines
- `TIME_SYSTEM.md` - Seasonal system documentation
- `docs/MAP_GUIDE.md` - Tile and sprite placement guide
- `design_docs/planned/PIXI_MIGRATION.md` - Rendering engine details
